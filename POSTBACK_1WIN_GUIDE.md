# S2S –ü–æ—Å—Ç–±–µ–∫–∏ –æ—Ç 1Win - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 30 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production-ready

---

## üìã –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è S2S –ø–æ—Å—Ç–±–µ–∫–æ–≤ –æ—Ç –∫–∞–∑–∏–Ω–æ 1Win –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Å–µ—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- ‚úÖ –í—ã–≤–æ–¥–æ–≤ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –í—ã–∏–≥—Ä—ã—à–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–æ–∑–∏—Ç–∞—Ö —Å —Å—É–º–º–æ–π
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É–¥–∞—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
1Win –ö–∞–∑–∏–Ω–æ
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –¥–µ–ø–æ–∑–∏—Ç –∏ —Ç.–¥.)
    ‚Üì
1Win –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à webhook
    ‚Üì
Webhook endpoint –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
    ‚Üì
PostbackHandler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
    ‚Üì
–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    ‚Üì
–ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (casino_id, is_deposited –∏ —Ç.–¥.)
```

### –°–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|-----------|---------|
| **registration** | user_id | –î–æ–±–∞–≤–∏—Ç—å casino_id, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ |
| **deposit** | user_id, amount | –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
| **withdrawal** | user_id, amount | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–≤–æ–¥–µ |
| **win** | user_id, amount | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É–¥–∞—á–µ (–Ω–µ —Å–ø–∞–º–∏—Ç—å) |

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. PostbackHandler (app/services/postback_handler.py)

**–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å—Ç–±–µ–∫–æ–≤.**

```python
class PostbackHandler:
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å—Ç–±–µ–∫
    async def handle_postback(event: PostbackEvent) -> Tuple[bool, str]
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
    def verify_signature(data: Dict, signature: str) -> bool
    
    # –ü–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    @staticmethod
    def parse_postback_data(data: Dict) -> Optional[PostbackEvent]
```

**–ú–µ—Ç–æ–¥—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
- `_handle_registration()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `_handle_deposit()` - –¥–µ–ø–æ–∑–∏—Ç
- `_handle_withdrawal()` - –≤—ã–≤–æ–¥
- `_handle_win()` - –≤—ã–∏–≥—Ä—ã—à

### 2. Webhook Endpoint (app/handlers/postback.py)

**REST API –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–æ—Å—Ç–±–µ–∫–æ–≤.**

Endpoints:
- `POST /postback/1win` - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –ø–æ—Å—Ç–±–µ–∫–æ–≤
- `GET /postback/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `POST /postback/test` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –ú–µ—Ç–æ–¥—ã –ë–î (app/database/db.py)

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–±–µ–∫–∞–º–∏:**

```python
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ casino_id
user = await db.get_user_by_casino_id(casino_id)

# –û–±–Ω–æ–≤–∏—Ç—å casino_id
await db.update_user_casino_id(user_id, casino_id)

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–µ–ø–æ–∑–∏—Ç–∞
await db.update_user_deposited(user_id, True)

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ
event = await db.get_last_event(user_id, "casino_win")
```

---

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ 1Win

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª—è—é—â–∏–π –±–æ—Ç

1. –ù–∞–π—Ç–∏ @BotFather –≤ Telegram
2. –í—ã–±—Ä–∞—Ç—å `/newbot`
3. –ó–∞–¥–∞—Ç—å –∏–º—è: "1Win Notifications"
4. –ó–∞–¥–∞—Ç—å username: "your_1win_notifications_bot"
5. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω!**

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å –≤–∞—à Telegram ID

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ (–∑–∞–º–µ–Ω–∏—Ç—å <BOT_TOKEN>)
https://api.telegram.org/bot<BOT_TOKEN>/getUpdates

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
# –í –æ—Ç–≤–µ—Ç–µ –Ω–∞–π—Ç–∏ –≤–∞—à ID –≤ –ø–æ–ª–µ "id"
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å—Ç–±–µ–∫–∏ –≤ 1Win

1. –ó–∞–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç 1Win
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "PR-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" ‚Üí "–°—Å—ã–ª–∫–∏"
3. –ù–∞–∂–∞—Ç—å –Ω–∞ –∑–Ω–∞—á–æ–∫ —Ü–µ–ø–∏ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å—Ç–±–µ–∫–æ–≤)
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ URL:

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
```
https://your-domain.com/postback/1win?event=registration&user_id={user_id}
```

#### –î–µ–ø–æ–∑–∏—Ç:
```
https://your-domain.com/postback/1win?event=deposit&user_id={user_id}&amount={amount}
```

#### –í—ã–≤–æ–¥:
```
https://your-domain.com/postback/1win?event=withdrawal&user_id={user_id}&amount={amount}
```

#### –í—ã–∏–≥—Ä—ã—à (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```
https://your-domain.com/postback/1win?event=win&user_id={user_id}&amount={amount}
```

**–ú–∞–∫—Ä–æ—Å—ã 1Win:**
- `{user_id}` - ID –∏–≥—Ä–æ–∫–∞ –≤ –∫–∞–∑–∏–Ω–æ
- `{amount}` - —Å—É–º–º–∞ (–¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞, –≤—ã–≤–æ–¥–∞, –≤—ã–∏–≥—Ä—ã—à–∞)

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoint

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost:3000/postback/health

# –û—Ç–≤–µ—Ç:
# {"status":"ok","service":"postback"}
```

### –¢–µ—Å—Ç 2: –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç–±–µ–∫

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç–±–µ–∫
curl -X POST "http://localhost:3000/postback/test?user_id=123&event=registration"

# –û—Ç–≤–µ—Ç:
# {
#   "success": true,
#   "message": "Registration processed",
#   "event": {
#     "type": "registration",
#     "user_id": "123",
#     "amount": null
#   }
# }
```

### –¢–µ—Å—Ç 3: –î–µ–ø–æ–∑–∏—Ç

```bash
curl -X POST "http://localhost:3000/postback/test?user_id=123&event=deposit&amount=1000"
```

### –¢–µ—Å—Ç 4: –í—ã–≤–æ–¥

```bash
curl -X POST "http://localhost:3000/postback/test?user_id=123&event=withdrawal&amount=500"
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

–ï—Å–ª–∏ 1Win –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∏ (HMAC-SHA256):

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `POSTBACK_SECRET_KEY` –≤ `.env`:
```bash
POSTBACK_SECRET_KEY=your_secret_key_from_1win
```

2. PostbackHandler –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –¥–ª—è webhook
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å–∏ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ gracefully
- ‚úÖ –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å sensitive –¥–∞–Ω–Ω—ã–µ –≤ –ª–æ–≥–∞—Ö

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–ó–∞–ø—Ä–æ—Å –æ—Ç 1Win:**
```
POST /postback/1win?event=registration&user_id=12345
```

**–î–µ–π—Å—Ç–≤–∏–µ –±–æ—Ç–∞:**
1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å casino_id = 12345
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!

–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ 1Win!

–¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–∏–º —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º —Å–∏–≥–Ω–∞–ª–∞–º. üìä
```

### –ü—Ä–∏–º–µ—Ä 2: –î–µ–ø–æ–∑–∏—Ç

**–ó–∞–ø—Ä–æ—Å –æ—Ç 1Win:**
```
POST /postback/1win?event=deposit&user_id=12345&amount=1000
```

**–î–µ–π—Å—Ç–≤–∏–µ –±–æ—Ç–∞:**
1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ casino_id = 12345
2. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üí∞ –î–µ–ø–æ–∑–∏—Ç –ø–æ–ª—É—á–µ–Ω!

–°—É–º–º–∞: 1000 ‚ÇΩ

–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –¢–µ–ø–µ—Ä—å —Ç—ã –≥–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ. üéÆ

–ò—Å–ø–æ–ª—å–∑—É–π –Ω–∞—à–∏ —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—ã–∏–≥—Ä—ã—à–∞! üöÄ
```

4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
‚úÖ –°–∏–≥–Ω–∞–ª—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!

–°–ø–∞—Å–∏–±–æ –∑–∞ –¥–µ–ø–æ–∑–∏—Ç –Ω–∞ —Å—É–º–º—É 1000 ‚ÇΩ

–¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º —Å–∏–≥–Ω–∞–ª–∞–º. üìä
```

### –ü—Ä–∏–º–µ—Ä 3: –í—ã–∏–≥—Ä—ã—à

**–ó–∞–ø—Ä–æ—Å –æ—Ç 1Win:**
```
POST /postback/1win?event=win&user_id=12345&amount=250
```

**–î–µ–π—Å—Ç–≤–∏–µ –±–æ—Ç–∞:**
1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ casino_id = 12345
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∏–≥—Ä—ã—à (–Ω–µ –±–æ–ª–µ–µ 1 –≤ 5 –º–∏–Ω—É—Ç)
3. –ï—Å–ª–∏ –Ω–µ —Å–ø–∞–º–∏–º - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
```
üèÜ –£–¥–∞—á–Ω–∞—è –∏–≥—Ä–∞!

–í—ã–∏–≥—Ä—ã—à: 250 ‚ÇΩ

–û—Ç–ª–∏—á–Ω–æ! –¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏! üí™

–°–ª–µ–¥–∏ –∑–∞ –Ω–∞—à–∏–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏ –¥–ª—è –µ—â–µ –±–æ–ª—å—à–∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π! üöÄ
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Production

### –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ—Ç–∞

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t gambling-bot .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker run -d \
  --name gambling-bot \
  -e TELEGRAM_TOKEN=your_token \
  -e REQUIRED_CHANNEL_ID=your_channel \
  -p 3000:3000 \
  gambling-bot
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å (ngrok)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ngrok
curl https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null && echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list && sudo apt update && sudo apt install ngrok

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ 1Win

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL –∏–∑ ngrok:
```
https://abc123.ngrok.io/postback/1win?event=registration&user_id={user_id}
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ 1Win
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

---

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ë–î —Ç–∞–±–ª–∏—Ü–∞ `events`:

```python
# –ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π
"casino_registration"  # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
"casino_deposit"       # –î–µ–ø–æ–∑–∏—Ç
"casino_withdrawal"    # –í—ã–≤–æ–¥
"casino_win"          # –í—ã–∏–≥—Ä—ã—à
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ç–∞–ª–µ–π:**
```json
{
  "casino_id": "12345",
  "amount": 1000,
  "timestamp": "2026-01-30T17:00:00"
}
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### Soft Gate ‚úÖ
- –ü–æ—Å—Ç–±–µ–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ
- Soft Gate —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

### Funnel Service ‚úÖ
- –ü–æ—Å—Ç–±–µ–∫ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ–ø–æ–∑–∏—Ç
- Funnel –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### AutoResponder ‚úÖ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–ø—Ä–æ—Å–∏—Ç—å –æ –¥–µ–ø–æ–∑–∏—Ç–µ
- AutoResponder –æ—Ç–≤–µ—Ç–∏—Ç

### Retention Service ‚úÖ
- –ü–æ—Å—Ç–±–µ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç is_deposited
- Retention –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å—Ç–±–µ–∫–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: `curl https://your-domain.com/postback/health`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ 1Win
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "User not found"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –±–æ—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ casino_id –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω —Å user_id
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ bot token –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∏–≥–Ω–∞–ª—ã –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–µ–ø–æ–∑–∏—Ç –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–ª–æ–≥–∏)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: `SELECT * FROM users WHERE casino_id = 'xxx'`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ signals_unlocked = 1

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

```python
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = await db.get_stats()

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
    "total_users": 100,
    "subscribed_users": 80,
    "signals_unlocked_users": 45,
    "deposited_users": 30  # ‚Üê –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞
}
```

### –ê–ª–µ—Ä—Ç—ã

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞:
- –û—à–∏–±–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ—Å—Ç–±–µ–∫–æ–≤
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook endpoint
- –ë–æ–ª—å—à–æ–π gap –º–µ–∂–¥—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è–º–∏ –∏ –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏

---

## üöÄ Production Checklist

- ‚úÖ PostbackHandler —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Webhook endpoint —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ë–î –º–µ—Ç–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ Ngrok —Ç—É–Ω–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ 1Win –ø–æ—Å—Ç–±–µ–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- ‚úÖ Production deployment –≥–æ—Ç–æ–≤

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**Q: –ö–∞–∫–æ–π format –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 1Win –¥–ª—è –ø–æ—Å—Ç–±–µ–∫–æ–≤?**
- A: Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL (GET-like, –Ω–æ POST –∑–∞–ø—Ä–æ—Å)

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–æ—Å—Ç–±–µ–∫–∏?**
- A: –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–∞–∑–∏–Ω–æ (–æ–±—ã—á–Ω–æ < 1 —Å–µ–∫)

**Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –±–æ—Ç–µ?**
- A: –ü–æ—Å—Ç–±–µ–∫ –±—É–¥–µ—Ç –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –±–æ—Ç –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–∑–∏–Ω–æ?**
- A: –î–∞, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å casino_name –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üéâ –ò—Ç–æ–≥–∏

**S2S –ø–æ—Å—Ç–±–µ–∫–∏ –æ—Ç 1Win —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã!**

- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- ‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Production-ready

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- üìà –í—ã—à–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —á—Ç–æ –±–æ—Ç "–∂–∏–≤–æ–π")
- üìà –í—ã—à–µ –¥–æ–≤–µ—Ä–∏–µ (—Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç –∫–∞–∑–∏–Ω–æ)
- üìà –õ—É—á—à–µ retention (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

---

**–ì–æ—Ç–æ–≤–æ –∫ production! üöÄ**
